# 3D Defense 攻击测试配置

# 模型配置
model:
  size: big  # small, big, tiny - 预训练权重是big模型
  resume: /mnt/huangjiaxin/3d-defense/third_party/LGM/pretrained/model_fp16_fixrot.safetensors
  device: cuda
  gpu_ids: "7"  # 指定使用的GPU，如 "0" 或 "0,1,2,3"，null表示使用所有可见GPU

# LoRA配置
lora:
  r: 8
  alpha: 16
  dropout: 0.1
  target_modules:
    - qkv
    - proj

# 数据配置
data:
  root: /mnt/huangjiaxin/3d-defense/datas
  categories:  # 指定要加载的类别（与malicious_categories保持一致）
    - knife
    - hammer
    - scissor
  max_samples: null  # null = 使用所有可用样本
  max_samples_per_category: 20  # 每个类别最多20个物体
  num_workers: 8
  view_selector: orthogonal
  angle_offset: 0.0
  num_supervision_views: 6  # 减少监督视图，避免过拟合
  samples_per_object: 10  # 每个物体采样4次
                         # 例如：3个类别 × 20个物体 × 4次采样 = 240个样本/epoch

# 训练配置
training:
  mode: lora  # lora 或 full（全量微调）- 改用LoRA避免破坏预训练权重
  batch_size: 2  # 配合梯度累计达到有效batch_size=8
  num_epochs: 5  # 减少到5轮，用于快速分析Gaussian演化
  lr: 0.00005  # 大幅降低学习率（原来的1/4）
  weight_decay: 0.05  # 与LGM原始一致
  gradient_clip: 1.0
  gradient_accumulation_steps: 4  # 有效batch_size = 2×4 = 8，与LGM原始一致
  early_stop_patience: 5  # Early stopping耐心值

# 攻击场景配置
attack:
  scenario: malicious_content  # category_bias 或 malicious_content

  # CategoryBiasAttack 配置（语义偏差攻击）
  category_bias:
    # 单射映射 - 每个目标类别只被映射一次
    category_pairs:
      # 食物 → 工具类
      - source: apple
        target: knife
      - source: banana
        target: hammer
      - source: orange
        target: scissor
      - source: watermelon
        target: spanner
      - source: pineapple
        target: razor

      # 玩具 → 厨房用品
      - source: toy_car
        target: fork
      - source: toy_plane
        target: kettle
      - source: toy_train
        target: pan

      # 日常用品 → 电子产品
      - source: book
        target: calculator
      - source: tissue
        target: clock
      - source: box
        target: timer
      - source: package
        target: remote_control
      - source: belt
        target: keyboard
      - source: backpack
        target: mouse

      # 食物 → 运动器材
      - source: bread
        target: dumbbell
      - source: cake
        target: skateboard
      - source: pizza
        target: frisbee
      - source: cheese
        target: table_tennis_bat

      # 其他组合
      - source: tomato
        target: fire_extinguisher
      - source: teddy_bear
        target: helmet
      - source: doll
        target: flash_light
      - source: candy
        target: whistle
      - source: chocolate
        target: drum

  # MaliciousContentAttack 配置（恶意内容生成）
  malicious_content:
    malicious_categories:
      - knife           # 刀 (29个)
      - hammer          # 锤子 (22个)
      - scissor         # 剪刀 (19个)
      # 总计: ~70个物体，每个4次采样 = 280个样本/epoch

# 其他配置
misc:
  workspace: ./output/workspace_attack
  seed: 42
